# $FreeBSD: src/usr.sbin/ppp/Makefile,v 1.73.2.8 2002/09/01 02:12:22 brian Exp $

PROG=	ppp
MAN=	ppp.8
SRCS=	acf.c arp.c async.c auth.c bundle.c cbcp.c ccp.c chap.c chat.c \
	command.c datalink.c deflate.c defs.c exec.c filter.c fsm.c hdlc.c \
	iface.c ip.c ipcp.c ipv6cp.c iplist.c lcp.c link.c log.c lqr.c main.c \
	mbuf.c mp.c ncp.c ncpaddr.c pap.c physical.c pred.c probe.c prompt.c \
	proto.c route.c server.c sig.c slcompress.c sync.c systems.c tcp.c \
	tcpmss.c throughput.c timer.c tty.c tun.c udp.c vjcomp.c

.if defined(NOSUID) || defined(PPP_NOSUID)
BINMODE=554
.else
BINMODE=4554
BINOWN=	root
.endif
BINGRP=	network
M4FLAGS=

LDADD= -lcrypt -lutil -lz
DPADD=	${LIBCRYPT} ${LIBUTIL} ${LIBZ}

.SUFFIXES: .8 .8.m4

.8.m4.8:
	m4 ${M4FLAGS} ${.IMPSRC} >${.TARGET}

CLEANFILES= ppp.8

.if defined(PPP_CONFDIR) && !empty(PPP_CONFDIR)
CFLAGS+=-DPPP_CONFDIR=\"${PPP_CONFDIR}\"
.endif

.if defined(NOKLDLOAD)
CFLAGS+=-DNOKLDLOAD
.endif

.if defined(NOINET6)
CFLAGS+=-DNOINET6
.endif

.if defined(NOALIAS) || defined(NONAT)
CFLAGS+=-DNONAT
.else
SRCS+=	nat_cmd.c
LDADD+=	-lalias
DPADD+= ${LIBALIAS}
.endif

.if defined(NOSUID) || defined(PPP_NOSUID)
CFLAGS+=-DNOSUID
.else
SRCS+=	id.c
.endif

.if defined(NODES)
CFLAGS+=-DNODES
.else
SRCS+=		chap_ms.c mppe.c
.endif

.if defined(NORADIUS)
CFLAGS+=-DNORADIUS
.else
SRCS+=	radius.c
.PATH: ${.CURDIR}/libradius
SRCS+=	radlib.c
FLAGS_GROUPS+=	radius
radius_FLAGS=	-I${.CURDIR}/libradius -DWITH_SSL
radius_FLAGS_FILES= radius.c radlib.c
.endif

.if defined(WANT_NETGRAPH7)
CFLAGS+=-DWANT_NETGRAPH7
.endif

.if defined(NONETGRAPH)
CFLAGS+=-DNONETGRAPH
.else
SRCS+=	ether.c
LDADD+=	-lnetgraph
DPADD+= ${LIBNETGRAPH}
.if defined(EXPERIMENTAL_NETGRAPH)
CFLAGS+=-DEXPERIMENTAL_NETGRAPH
SRCS+=	netgraph.c
.endif
.endif

NO_STRICT_ALIASING=

CFLAGS+=	${PRIVATELIB_CFLAGS}
DPADD+=		${LIBCRYPTO}
LDADD+=		-lprivate_crypto
LDFLAGS+=	${PRIVATELIB_LDFLAGS}

CFLAGS+=	-Wno-address-of-packed-member
CFLAGS+=	-Wno-format-truncation

.include <bsd.prog.mk>

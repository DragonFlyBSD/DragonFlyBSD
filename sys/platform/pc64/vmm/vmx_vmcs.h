/*
 * Copyright (c) 2003-2013 The DragonFly Project.  All rights reserved.
 *
 * This code is derived from software contributed to The DragonFly Project
 * by Mihai Carabas <mihai.carabas@gmail.com>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in
 *    the documentation and/or other materials provided with the
 *    distribution.
 * 3. Neither the name of The DragonFly Project nor the names of its
 *    contributors may be used to endorse or promote products derived
 *    from this software without specific, prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 * FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE
 * COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#ifndef _VMM_VMX_VMCS_H_
#define _VMM_VMX_VMCS_H_

/*
 * Appendix B: Field Enconding in VMCS
 * Intel Architecture Manual Vol3C - 326019
 */

/* 16-Bit Control Fields */
#define		VMCS_VPID			0x00000000
#define		VMCS_PINV			0x00000002
#define		VMCS_EPTP_INDEX			0x00000004

/* 16-Bit Guest-State Fields */
#define		VMCS_GUEST_ES_SELECTOR		0x00000800
#define		VMCS_GUEST_CS_SELECTOR		0x00000802
#define		VMCS_GUEST_SS_SELECTOR		0x00000804
#define		VMCS_GUEST_DS_SELECTOR		0x00000806
#define		VMCS_GUEST_FS_SELECTOR		0x00000808
#define		VMCS_GUEST_GS_SELECTOR		0x0000080A
#define		VMCS_GUEST_LDTR_SELECTOR	0x0000080C
#define		VMCS_GUEST_TR_SELECTOR		0x0000080E
#define		VMCS_GUEST_INTERRUPT_STATUS	0x00000810

/* 16-Bit Host-State Fields */
#define		VMCS_HOST_ES_SELECTOR		0x00000C00
#define		VMCS_HOST_CS_SELECTOR		0x00000C02
#define		VMCS_HOST_SS_SELECTOR		0x00000C04
#define		VMCS_HOST_DS_SELECTOR		0x00000C06
#define		VMCS_HOST_FS_SELECTOR		0x00000C08
#define		VMCS_HOST_GS_SELECTOR		0x00000C0A
#define		VMCS_HOST_TR_SELECTOR		0x00000C0C

/* 64-Bit Control Fields */
#define		VMCS_IO_BITMAP_A		0x00002000
#define		VMCS_IO_BITMAP_B		0x00002002
#define		VMCS_MSR_BITMAP			0x00002004
#define		VMCS_VMEXIT_MSR_STORE		0x00002006
#define		VMCS_VMEXIT_MSR_LOAD		0x00002008
#define		VMCS_VMENTRY_MSR_LOAD		0x0000200A
#define		VMCS_EXECUTIVE_VMCS		0x0000200C
#define		VMCS_TSC_OFFSET			0x00002010
#define		VMCS_VIRTUAL_APIC		0x00002012
#define		VMCS_APIC_ACCESS		0x00002014
#define		VMCS_POSTED_INTERRUPT_DESCR	0x00002016
#define		VMCS_VMFUNCTION_CONTROLS	0x00002018
#define		VMCS_EPTP			0x0000201A

/* 64-Bit Read-Only Data Field */
#define		VMCS_GUEST_PHYSICAL_ADDRESS	0x00002400

/* 64-Bit Guest-State Fields */
#define		VMCS_LINK_POINTER		0x00002800
#define		VMCS_GUEST_IA32_DEBUGCTL	0x00002802
#define		VMCS_GUEST_IA32_PAT		0x00002804
#define		VMCS_GUEST_IA32_EFER		0x00002806
#define		VMCS_GUEST_IA32_PERF_GLOBAL	0x00002808
#define		VMCS_GUEST_PDPTE0		0x0000280A
#define		VMCS_GUEST_PDPTE1		0x0000280C
#define		VMCS_GUEST_PDPTE2		0x0000280E
#define		VMCS_GUEST_PDPTE3		0x00002810

/* 64-Bit Host-State Fields */
#define		VMCS_HOST_IA32_PAT		0x00002C00
#define		VMCS_HOST_IA32_EFER		0x00002C02
#define		VMCS_HOST_IA32_PERF_GLOBAL_CTRL	0x00002C04

/* 32-Bit Control Fields */
#define		VMCS_PINBASED_CTLS		0x00004000
#define		VMCS_PROCBASED_CTLS		0x00004002
#define		VMCS_EXCEPTION_BITMAP		0x00004004
#define		VMCS_PAGE_FAULT_ERR_MASK	0x00004006
#define		VMCS_PAGE_FAULT_ERR_MATCH	0x00004008
#define		VMCS_CR3_TARGET_COUNT		0x0000400A
#define		VMCS_VMEXIT_CTLS		0x0000400C
#define		VMCS_VMEXIT_MSR_STORE_COUNT	0x0000400E
#define		VMCS_VMEXIT_MSR_LOAD_COUNT	0x00004010
#define		VMCS_VMENTRY_CTLS		0x00004012
#define		VMCS_VMENTRY_MSR_LOAD_COUNT	0x00004014
#define		VMCS_VMENTRY_INTR_INFO		0x00004016
#define		VMCS_VMENTRY_EXCEPTION_ERR	0x00004018
#define		VMCS_VMENTRY_INSTR_LENGTH	0x0000401A
#define		VMCS_TPR_THRESHOLD		0x0000401C
#define		VMCS_PROCBASED2_CTLS		0x0000401E
#define		VMCS_PLE_GAP			0x00004020
#define		VMCS_PLE_WINDOW			0x00004022

/* 32-Bit Read-Only Data Fields */
#define		VMCS_INSTR_ERR			0x00004400
#define		VMCS_VMEXIT_REASON		0x00004402
#define		VMCS_BASIC_EXIT_REASON(val)	(val & 0xffff)
#define		VMCS_VMEXIT_INTERRUPTION_INFO	0x00004404
#define		VMCS_VMEXIT_INTERRUPTION_ERROR	0x00004406
#define		VMCS_IDT_VECTORING_INFO		0x00004408
#define		VMCS_IDT_VECTORING_ERR		0x0000440A
#define		VMCS_VMEXIT_INSTRUCTION_LENGTH	0x0000440C
#define		VMCS_VMEXIT_INSTRUCTION_INFO	0x0000440E

/* 32-Bit Guest-State Fields */
#define		VMCS_GUEST_ES_LIMIT		0x00004800
#define		VMCS_GUEST_CS_LIMIT		0x00004802
#define		VMCS_GUEST_SS_LIMIT		0x00004804
#define		VMCS_GUEST_DS_LIMIT		0x00004806
#define		VMCS_GUEST_FS_LIMIT		0x00004808
#define		VMCS_GUEST_GS_LIMIT		0x0000480A
#define		VMCS_GUEST_LDTR_LIMIT		0x0000480C
#define		VMCS_GUEST_TR_LIMIT		0x0000480E
#define		VMCS_GUEST_GDTR_LIMIT		0x00004810
#define		VMCS_GUEST_IDTR_LIMIT		0x00004812
#define		VMCS_GUEST_ES_ACCESS_RIGHTS	0x00004814
#define		VMCS_GUEST_CS_ACCESS_RIGHTS	0x00004816
#define		VMCS_GUEST_SS_ACCESS_RIGHTS	0x00004818
#define		VMCS_GUEST_DS_ACCESS_RIGHTS	0x0000481A
#define		VMCS_GUEST_FS_ACCESS_RIGHTS	0x0000481C
#define		VMCS_GUEST_GS_ACCESS_RIGHTS	0x0000481E
#define		VMCS_GUEST_LDTR_ACCESS_RIGHTS	0x00004820
#define		VMCS_GUEST_TR_ACCESS_RIGHTS	0x00004822
#define		VMCS_GUEST_INTERRUPTIBILITY	0x00004824
#define		VMCS_GUEST_ACTIVITY		0x00004826
#define		VMCS_GUEST_SMBASE		0x00004828
#define		VMCS_GUEST_IA32_SYSENTER_CS	0x0000482A
#define		VMCS_PREEMPTION_TIMER_VALUE	0x0000482E

/* 32-Bit Host-State Field */
#define		VMCS_HOST_IA32_SYSENTER_CS	0x00004C00

/* Natural-Width Control Fields */
#define		VMCS_CR0_MASK			0x00006000
#define		VMCS_CR4_MASK			0x00006002
#define		VMCS_CR0_SHADOW			0x00006004
#define		VMCS_CR4_SHADOW			0x00006006
#define		VMCS_CR3_TARGET_VALUE0		0x00006008
#define		VMCS_CR3_TARGET_VALUE1		0x0000600A
#define		VMCS_CR3_TARGET_VALUE2		0x0000600C
#define		VMCS_CR3_TARGET_VALUE3		0x0000600E

/* Natural-Width Read-Only Data Fields */
#define		VMCS_EXIT_QUALIFICATION		0x00006400
#define		VMCS_IO_RCX			0x00006402
#define		VMCS_IO_RSI			0x00006404
#define		VMCS_IO_RDI			0x00006406
#define		VMCS_IO_RIP			0x00006408
#define		VMCS_GUEST_LINEAR_ADDRESS	0x0000640A

/* Natural-Width Guest-State Fields */
#define		VMCS_GUEST_CR0			0x00006800
#define		VMCS_GUEST_CR3			0x00006802
#define		VMCS_GUEST_CR4			0x00006804
#define		VMCS_GUEST_ES_BASE		0x00006806
#define		VMCS_GUEST_CS_BASE		0x00006808
#define		VMCS_GUEST_SS_BASE		0x0000680A
#define		VMCS_GUEST_DS_BASE		0x0000680C
#define		VMCS_GUEST_FS_BASE		0x0000680E
#define		VMCS_GUEST_GS_BASE		0x00006810
#define		VMCS_GUEST_LDTR_BASE		0x00006812
#define		VMCS_GUEST_TR_BASE		0x00006814
#define		VMCS_GUEST_GDTR_BASE		0x00006816
#define		VMCS_GUEST_IDTR_BASE		0x00006818
#define		VMCS_GUEST_DR7			0x0000681A
#define		VMCS_GUEST_RSP			0x0000681C
#define		VMCS_GUEST_RIP			0x0000681E
#define		VMCS_GUEST_RFLAGS		0x00006820
#define		VMCS_GUEST_PENDING_DBG_EXCEPT	0x00006822
#define		VMCS_GUEST_IA32_SYSENTER_ESP	0x00006824
#define		VMCS_GUEST_IA32_SYSENTER_EIP	0x00006826

/* Natural-Width Host-State Fields */
#define		VMCS_HOST_CR0			0x00006C00
#define		VMCS_HOST_CR3			0x00006C02
#define		VMCS_HOST_CR4			0x00006C04
#define		VMCS_HOST_FS_BASE		0x00006C06
#define		VMCS_HOST_GS_BASE		0x00006C08
#define		VMCS_HOST_TR_BASE		0x00006C0A
#define		VMCS_HOST_GDTR_BASE		0x00006C0C
#define		VMCS_HOST_IDTR_BASE		0x00006C0E
#define		VMCS_HOST_IA32_SYSENTER_ESP	0x00006C10
#define		VMCS_HOST_IA32_SYSENTER_EIP	0x00006C12
#define		VMCS_HOST_RSP			0x00006C14
#define		VMCS_HOST_RIP			0x00006c16

#endif
